{
   "comment": "Instant parser",
   "lex": {
      "rules": [
         ["\\s+",                    "/* skip whitespace */"],
         ["[0-9]+",                  "return 'NUMBER'"],
         ["[a-zA-Z_][0-9a-zA-Z_]*",  "return 'STRING'"],
         ["\\*",                     "return '*'"],
         ["\\/",                     "return '/'"],
         ["-",                       "return '-'"],
         ["\\+",                     "return '+'"],
         ["=",                       "return '='"],
         [";",                       "return ';'"],
         ["$",                       "return 'EOF'"]
      ]
   },

   "operators": [
      ["right", "+" ],
      ["left", "-"],
      ["left", "*", "/"]
   ],

   "bnf": {
      "expressions": [
         ["p ; EOF",   "return yy.data;"]
      ],

      "p": [
         ["stmt", "yy.data.program.push($1);"],
         ["p ; stmt", "yy.data.program.push($3);"]
      ],

      "stmt": [
         ["id = e", "yy.data.env[$1] = true; $$ = {type: 'stmt', value: '=', left:$1, right: $3}"],
         ["e", "$$ = $1"]
      ],

      "id": [
         ["STRING", "$$ = String(yytext)"]
      ],

      "e" :[
         ["e + e",  "$$ = {type: 'exp', value: '+', left:$1, right: $3}"],
         ["e - e",  "$$ = {type: 'exp', value: '-', left:$1, right: $3}"],
         ["e * e",  "$$ = {type: 'exp', value: '*', left:$1, right: $3}"],
         ["e / e",  "$$ = {type: 'exp', value: '/', left:$1, right: $3}"],
         ["id",     "if(yy.data.env[$1] !== true) {parseError('Undeclared variable \"' + $1 + '\" at line ' + yylineno + ':' + this._$.first_column, {token: $1, line: yylineno, loc: this._$, parse: true})} $$ = $1"],
         ["NUMBER", "$$ = Number(yytext)"]
      ]
   }
}
